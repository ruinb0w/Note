# 终端命令行

### 导入数据库

mongoimport -d 数据库名 -c 集合名称 -file 要导入的数据文件

# mongodb命令行

## 基本CRUD操作

### Create

| 语法                                        | 说明             |
| ------------------------------------------- | ---------------- |
| `use 数据库名`                              | 切换(创建)数据库 |
| `db.createCollection(集合名)`               | 创建集合         |
| `db.集合.insert({字段: 值})`                | 插入单个文档     |
| `db.集合.insertMany({字段: 值},{字段: 值})` | 插入多个文档     |

### Read

| 语法                                         | 说明                                           |
| -------------------------------------------- | ---------------------------------------------- |
| `show dbs`                                   | 显示已有的数据库                               |
| `db`                                         | 显示当前数据库                                 |
| `show collections`                           | 显示集合                                       |
| `db.集合.find()`                             | 查找集合条目                                   |
| `db.集合.find().count()`                     | 对查找到的条目计数c                            |
| `db.集合.find().skip(数值)`                  | 跳过条目数                                     |
| `db.集合.find().limit(数值)`                 | 限制查询条目,和skip结合可以实现分页查找        |
| `db.集合.find({查询条件}, {字段:1, 字段:0})` | 只显示规定字段, 值为1表示显示, 值为0表示不显示 |

### Update

| 语法                                                         | 说明                   |
| ------------------------------------------------------------ | ---------------------- |
| `db.表名.update({查询条件},{修改内容})`                      | 覆盖更新文档           |
| `db.集合名.update({查询条件},{$set: {修改内容}})`            | 更新某个条目           |
| `db.集合名.update({查询条件},{$set: {修改内容}}, multi: true}` | 更新多个文档的相同条目 |
| `db.集合名字.update({查询条件},{$inc:{条目: 增长值}})`       | 列增长                 |

### Delete

| 语法                         | 说明       |
| ---------------------------- | ---------- |
| `db.dropDatabase()`          | 删除数据库 |
| `db.集合名.drop()`           | 删除集合   |
| `db.集合.remove({查询条件})` | 删除文档   |

## 查询

### 统计查询

统计字段数

`db.集合.count()`

根据条件统计

`db.集合.count({查询条件})`

### 分页查询

限制获得的条目数

`db.集合.find().limit(3)`

跳过某些条目

`db.集合.find().skip(3).limit(3)`

> 这里就跳过了前三条获得第4-6条

### 查询排序

`db.集合.find().sort(1)`

> 1为升序, -1 为降序

### 正则查询

`db.集合.find({字段: /正则/})`

### 比较查询

`db.集合.find({字段: {$gt: 值}})` 大于

`db.集合.find({字段: {$lt: 值}})` 小于

`db.集合.find({字段: {$eq: 值}})` 等于

`db.集合.find({字段: {$ge: 值}})` 大于等于

`db.集合.find({字段: {$le: 值}})` 小于等于

`db.集合.find({字段: {$ne: 值}})` 不等于

### 包含查询

`db.集合.find({字段: {$in:[字段值, 字段值]}})`

`db.集合.find({字段: {$nin:[字段值, 字段值]})`

### 条件连接查询

`db.集合.find({$and:[{字段: 值}, {字段: 值}]})` 查询到两个条件都满足

`db.集合.find($or:[{字段: 值}, {字段: 值}])` 满足一个字段即可

## 索引

### 查看索引

`db.集合.getIndexes()`

### 创建索引

`db.集合.createIndex({keys}, {options})`

* keys

  * `字段: 1|-1` 1表示升序, -1表示降序

* options

  * `unique: Boolean` 字段是否唯一

* 示例

  ```js
  // 展示以age字段升序建立索引
  db.collection1.createIndex({age:1})
  ```

### 删除索引

`db.集合.dropIndex(index)`

* index 可以是索引名称, 也可以条件删除

* 示例

  ````js
  // 名称删除
  db.colloction1.dropIndex("age_1_")
  // 条件删除
  db.collection1.dropIndex({age:1})
  // 删除所有索引, 默认的_id不会被删除
  db.collection1.dropIndexes()
  ````

### 执行计划

用于查看索引是否生效

`db.集合.find().explain()`

## 其他

### 错误处理

由于批量操作容易出错, 并且出错后并不会回滚数据, 所以需要知道哪里出错

```js
try{
    // 批量操作
}catch(err){
    print(err);
}
```

### mongodb 默认创建的数据库

admin:

local:

config: 